@{
    ViewData["Title"] = "View Past Categories";
}

@model List<EventAttendanceRecord>

    <!DOCTYPE html>
    <html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">

    </head>
    <body>
        <form>
            <button type="submit" class="RP_backBtn" asp-controller="Menus" asp-action="MainMenu">Back</button>
        </form>
        
        <br />

        <div class="RP_categoryContainer">
            <div class="RP_categoryList">
                <form asp-controller="Form" method="post">
                    <h2 class="text-center">Categories</h2>


                    @if (Model.Count == 0)
                    {
                        <p>No category to show</p>
                    }
                    else
                    {
                        <div>
                            <br />
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th><input type="checkbox" onclick="toggle(this)" value="Select All" /> Select All</th>
                                        <th>Category Name</th>
                                        <th>Category Date</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @{
                                        foreach (var category in Model)
                                        {
                                            <tr>
                                                <td><input type="checkbox" onclick="submitForm(this)" name="category" value="@category.Id" />
                                                <td>@category.EventName</td>
                                                <td>@category.Date.ToString("MM/dd/yyyy")</td>
                                            </tr>
                                        }
                                    }
                                </tbody>
                            </table>
                        </div>
                        <input type="hidden" id="selectedCategoryIdsField" name="selectedCategoryIds">
                        <button type="submit" class="RP_visualRPBtn" asp-action="RP_VisualReportPage">Generate Report</button>
                        <button type="submit" class="RP_dataBtn" asp-action="RP_DownloadRawData">Download Data</button>
                    }

                </form>
            </div>

            <div class="RP_filterGroup">
                <form asp-controller="Form" method="post">
                    <h3>Filter</h3>
                    <br />
                    <h6>Date</h6>
                    <label for="startDate">From:</label>
                    <input type="date" class="form-control" name="startDate" id="startDate">
                    <br />
                    <label for="endDate">To:</label>
                    <input type="date" class="form-control" name="endDate" id="endDate">
                    <br />
                    <h6>Tags</h6>
                    <br />
                    <h6>Category</h6>
                    <input type="checkbox" name="events" value="true" />Event
                    <br />
                    <input type="checkbox" name="programs" value="true" />Program
                    <br />
                    <input type="checkbox" name="cafes" value="true" />Cafe Visit
                    <br />
                    <br />
                    <button type="submit" class="RP_filterBtn" asp-action="RP_ViewPastCategories">Submit</button>
                    <button type="submit" class="RP_filterBtn" asp-action="RP_ViewPastCategories">Remove Filters</button>
                </form>
            </div>

        </div>
    </body>
</html>

<script language="JavaScript">

    /*Function selects all checkboxes*/
    function toggle(source) {
        checkboxes = document.getElementsByName('category');
        var selectedCategoryIds = [];

        for (var i = 0, n = checkboxes.length; i < n; i++) {
            checkboxes[i].checked = source.checked;
            if (checkboxes[i].checked) {
                selectedCategoryIds.push(checkboxes[i].value);
            }
        }

        document.getElementById('selectedCategoryIdsField').value = selectedCategoryIds.join(',');
    }

    /*Function gathers all selected checkboxes and submits the form*/
    function submitForm() {
        // Get all the checked checkboxes
        var selectedCheckboxes = document.querySelectorAll('input[type="checkbox"]:checked');

        if (selectedCheckboxes.length === 0) {
            alert("No items selected.");
            return; // Exit if no checkboxes are selected
        }

        // Clear any existing hidden inputs (if the form is being resubmitted)
        var form = document.getElementById("myForm");
        var existingHiddenInputs = form.querySelectorAll('input[type="hidden"]');
        existingHiddenInputs.forEach(function (input) {
            input.remove();
        });

        // Loop through the selected checkboxes and create hidden input elements
        selectedCheckboxes.forEach(function (checkbox) {
            var hiddenInput = document.createElement("input");
            hiddenInput.type = "hidden";
            hiddenInput.name = "category";
            hiddenInput.value = checkbox.value;
            form.appendChild(hiddenInput);
        });

        form.submit();
    }

    /*Function submits form manually*/
    $(".RP_submitBtn").click(function (e) {
        e.preventDefault();

        $(this).closest("form").submit();
    });
</script>
