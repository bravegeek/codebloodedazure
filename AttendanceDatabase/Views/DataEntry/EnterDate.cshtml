@{
    ViewData["Title"] = "Enter Date";



    var todayDate = DateTime.Now.ToString("yyyy-MM-dd");



    var monthNames = new string[]

    {
        "January", "February", "March", "April", "May", "June",
        "July", "August", "September", "October", "November", "December"

    };



    var currentMonthIndex = DateTime.Now.Month - 1; // Adjust index for array (0-based)

    var currentMonth = monthNames[currentMonthIndex];

    var currentYear = DateTime.Now.Year;
}

<h2>Select a Date</h2>

<div class="calendar-container">
    <div class="calendar-header">
        <button type="button" id="prevMonth" class="calendar-nav-btn">-</button>
        <span id="calendarMonth">@currentMonth</span>
        <button type="button" id="nextMonth" class="calendar-nav-btn">+</button>

        <button type="button" id="prevYear" class="year-nav-btn">−</button>
        <span id="calendarYear">@currentYear</span>
        <button type="button" id="nextYear" class="year-nav-btn">+</button>
    </div>

    <div id="calendar" class="calendar">
    </div>
</div>

<form asp-action="DataEntry" method="post">
    <input type="hidden" name="date" id="selectedDate" value="@todayDate" />
    <button type="submit" class="RP_filterBtn">Enter Date</button>
</form>

<script>
    const monthNames = [
        "January", "February", "March", "April", "May", "June",
        "July", "August", "September", "October", "November", "December"
    ];

    function generateCalendar(month, year) {
        const daysInMonth = new Date(year, month + 1, 0).getDate(); // Month is 0-based
        const firstDay = new Date(year, month, 1).getDay();
        let calendarHTML = '<table><tr>';

        const weekdays = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
        weekdays.forEach(day => calendarHTML += `<th>${day}</th>`);
        calendarHTML += '</tr><tr>';

        for (let i = 0; i < firstDay; i++) {
            calendarHTML += '<td></td>';
        }

        for (let day = 1; day <= daysInMonth; day++) {
            const dateStr = `${year}-${(month + 1).toString().padStart(2, '0')}-${day.toString().padStart(2, '0')}`;
            calendarHTML += `<td><button type="button" class="calendar-day" data-date="${dateStr}">${day}</button></td>`;

            if ((firstDay + day) % 7 === 0) {
                calendarHTML += '</tr><tr>';
            }
        }

        calendarHTML += '</tr></table>';
        document.getElementById("calendar").innerHTML = calendarHTML;
    }

    document.getElementById('prevMonth').addEventListener('click', function () {
        currentMonth--;
        if (currentMonth < 0) {
            currentMonth = 11;
            currentYear--;
        }
        document.getElementById('calendarMonth').textContent = monthNames[currentMonth];
        document.getElementById('calendarYear').textContent = currentYear;
        generateCalendar(currentMonth, currentYear);
    });

    document.getElementById('nextMonth').addEventListener('click', function () {
        currentMonth++;
        if (currentMonth > 11) {
            currentMonth = 0;
            currentYear++;
        }
        document.getElementById('calendarMonth').textContent = monthNames[currentMonth];
        document.getElementById('calendarYear').textContent = currentYear;
        generateCalendar(currentMonth, currentYear);
    });

    document.getElementById('prevYear').addEventListener('click', function () {
        currentYear--;
        document.getElementById('calendarYear').textContent = currentYear;
        generateCalendar(currentMonth, currentYear);
    });

    document.getElementById('nextYear').addEventListener('click', function () {
        currentYear++;
        document.getElementById('calendarYear').textContent = currentYear;
        generateCalendar(currentMonth, currentYear);
    });

    document.addEventListener('click', function (e) {
        if (e.target && e.target.classList.contains('calendar-day')) {
            const selectedDate = e.target.getAttribute('data-date');
            document.getElementById('selectedDate').value = selectedDate;

            const selectedDayBtn = document.querySelector('.calendar-day.selected');
            if (selectedDayBtn) selectedDayBtn.classList.remove('selected');
            e.target.classList.add('selected');
        }
    });

    let currentMonth = new Date().getMonth();
    let currentYear = new Date().getFullYear();
    document.getElementById('calendarMonth').textContent = monthNames[currentMonth];
    document.getElementById('calendarYear').textContent = currentYear;
    generateCalendar(currentMonth, currentYear);

            window.addEventListener('DOMContentLoaded', () => {
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.get('autofill') === 'true') {
                const today = new Date();
                const formatted = today.toISOString().split('T')[0]; // "yyyy-mm-dd"
                document.getElementById('selectedDate').value = formatted;

                // Set calendar UI to today’s date visually (optional)
                const btns = document.querySelectorAll('.calendar-day');
                btns.forEach(btn => {
                    if (btn.dataset.date === formatted) {
                        btn.classList.add('selected');
                    }
                });

                // Submit the form
                document.querySelector('form').submit();
            }
        });
</script>
